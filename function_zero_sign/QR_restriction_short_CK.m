% function [P] = QR_restriction_short(Sigma)

%@Rubio-Ramirez, Waggoner, and Zha (2010, RES, p665-696)
%  
%  p.678  Sec.5.2 A monetary SVAR

nk = 7;

% A0‚Ì‚UŒÂ‚Ìƒ[ƒ§–ñ --> 1‚Ì”‚Í6‚Â 
Q1 = [0 0 0 0 0 0 0; ...   % short run y
      0 0 0 0 0 0 0; ...   % c
      0 0 0 0 0 0 0; ...   % tax
      0 0 0 0 0 0 0;...    % g
      0 0 0 0 0 0 0; ...  % inv
      0 0 0 0 0 0 0; ...  % int
      0 0 0 0 0 0 0 ]' ;  % pi
  
% A0‚Ì5ŒÂ‚Ìƒ[ƒ§–ñ  --> 1‚Ì”‚Í5‚Â
Q2 =  [0 0 0 0 0 0 0; ...   % short run y
      0 0 0 0 0 0 0; ...   % c
      0 0 0 0 0 0 0; ...   % tax
      0 0 0 0 0 0 0;...    % g
      0 0 0 0 0 0 0; ...  % inv
      0 0 0 0 0 0 0; ...  % int
      0 0 0 0 0 0 0 ]' ;  % pi

 % A0‚Ì4ŒÂ‚Ìƒ[ƒ§–ñ--> 1‚Ì”‚Í4‚Â 
Q3 = [0 0 0 0 0 0 0; ...   % short run y
      0 0 0 0 0 0 0; ...   % c
      0 0 0 0 0 0 0; ...   % tax
      0 0 0 0 0 0 0;...    % g
      0 0 0 0 0 0 0; ...  % inv
      0 0 0 0 0 0 0; ...  % int
      0 0 0 0 0 0 0 ]' ;  % pi
 
  % A0‚Ì3ŒÂ‚Ìƒ[ƒ§–ñ --> 1‚Ì”‚Í3‚Â  
Q4 =  [0 0 0 0 0 0 0; ...   % short run y
      0 0 0 0 0 0 0; ...   % c
      0 0 0 0 0 0 0; ...   % tax
      0 0 0 0 0 0 0;...    % g
      0 0 0 0 0 0 0; ...  % inv
      0 0 0 0 0 0 0; ...  % int
      0 0 0 0 0 0 0]' ;  % pi

 % A0‚Ì2ŒÂ‚Ìƒ[ƒ§–ñ--> 1‚Ì”‚Í2‚Â 
Q5  =  [0 0 0 0 0 0 0; ...   % short run y
      0 0 0 0 0 0 0; ...   % c
      1 0 0 0 0 0 0; ...   % tax
      0 0 0 0 0 0 0;...    % g
      0 0 0 0 0 0 0; ...  % inv
      0 1 0 0 0 0 0; ...  % int
      0 0 0 0 0 0 0]' ;  % pi
  
 % A0‚Ì1ŒÂ‚Ìƒ[ƒ§–ñ --> 1‚Ì”‚Í1‚Â 
Q6  =  [0 0 0 0 0 0 0; ...   % short run y
      0 0 0 0 0 0 0; ...   % c
      0 0 0 0 0 0 0; ...   % tax
      0 0 0 0 0 0 0;...    % g
      0 0 0 0 0 0 0; ...  % inv
      0 0 0 0 0 0 0; ...  % int
      0 0 0 0 0 0 0 ]' ;  % pi 
  
  Q=zeros(7,7,6);
Q(:,:,1) = Q1;
Q(:,:,2) = Q2;
Q(:,:,3) = Q3;
Q(:,:,4) = Q4;
Q(:,:,5) = Q5;
 Q(:,:,6) = Q6; 


% —U“±ŒnVARƒ‚ƒfƒ‹‚Ì•ªU‹¤•ªUs—ñ
Sigma = [1   0.5  0.5  0.5 0.2 0.1 0.1 ;...
        0.5 4.25 2.5  0.5  0.25 0  0 ;...
        0.5  2.5  3   0.5  0.1  0  0;...
        0.5  0.5  0.5  2   0.15 0  0 ; ...
        0.2  0.25  0.1 0.15   4  0 0 ;...
        0.1  0     0    0   0   1  0
        0.1  0     0    0   0   0  1 ] ;

 invsig = inv(Sigma);
 A0 = chol(invsig);

 % inv(A0'*A0);
% invA0 = inv(A0');
% invA0'*invA0*A0'*A0; %
% invA0'*invA0;
% chol(sigma)'*chol(sigma);

%---------------------------
%disp('’ZŠú§–ñ');
F = [A0];

P=[];

for i = 1:nk-1

   Q_bar = abs(orth(squeeze(Q(:,:,i))')); 
   
   if isempty(Q_bar) == 1
         x1 = randn(nk-i,nk); % §–ñi‚ğƒ_ƒ~[‚Åˆ—
         Q_til = [x1; P'];
         [QQ,T]=qr(Q_til');
   else    
         % §–ñ i ‚Ìˆ— 
           Q_til = [Q_bar' * F; P'];
         % QR decomposition
           [QQ,T]=qr(Q_til');
   end
         col_P = QQ(:,nk); % ’¼Œğs—ñ P‚Ìi—ñ–Ú
         P=[P col_P ]; 
 end    
   
   Q_til = P';
   [QQ,T]=qr(Q_til');
   col_P = QQ(:,nk); % ’¼Œğs—ñ P‚ÌÅI—ñ–Ú
   P=[P col_P ]; 

%disp('’¼Œğs—ñ‚ÌŒŸZ P*P = I');
disp(' ')
disp('P^T * P = ')
P'*P  %@’¼Œğs—ñ‚ÌŒŸZ

% §–ñ‚ÌŒŸZ
disp( ' ' )
disp('A0 = Sig * P = ')
A0*P
